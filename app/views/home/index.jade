extends ../shared/layouts/application

block scripts
	- if (current_user)
		script.
			var _currentUserId = !{current_user.id};
	- if (room)
		script.
			var _preloadedRoomId = !{room.id};

	script(src='/javascript/application.js')

block content
	div#huddle-app

	script#huddle-template(type='text/ractive')
		div#huddle-app-container.flexbox.huddle-container
			div#left-sidebar.flexitem.sidebar.sidebar-left
				section
					<RoomList>
				section
					<PrivateMessageList>

			div#chat-area-container.flexitem.chat-area
				<Room>

	script#room-template(type='text/ractive')
		header.room-header
			div.room-header-inner
				//- i.fa.fa-lock.fa-2x
				div.page-header-main
					h3 {{ activeRoom.name }}
					p {{ activeRoom.description }}
		section#room-container.flexbox.room-container
			div#chat-message-area.flexitem.chat-message-area
				<RoomMessages>

			div#sidebar-right.flexitem.sidebar-right
				<RoomUsers>
	script#room-users-template(type='text/ractive')
		div#chat-users.users
			ul.users-list.sidebar-nav
				{{ #each users }}
				<RoomUser user="{{ . }}">
				{{ /each }}

	script#room-user-template(type='text/ractive')
		li.user-information
			div.user-metadata
				a(href='/chat/user/{{ id }}' on-click="privateMessage:{{ user }}")
					i.fa.fa-circle(class="{{ status }}")
					| {{ displayName }}

	script#room-messages-template(type='text/ractive')
		div.scroll-wrapper
			div.flexbox.chat-message-wrapper
				div#chat-messages.flexitem.messages
					{{ #each messages:i }}
					div#chat-message-container.message-container.flexbox(class = "{{ from_user ? 'server-message' : '' }}{{ _.pluck(tags, 'name').join(' ') }} {{ user.id === ~/current_user.id ? 'current-user' : '' }}")
						div#chat-username.flexitem.username 
							{{ #if i === 0 || messages[i - 1].user.id !== user.id }}
							{{ user.displayName }}
							{{ /if }}
						div#chat-message.flexitem.message {{{ html }}}
						div#chat-timestamp.flexitem.timestamp(title="{{ timeAgoInWords(created_at) }}") {{ formatTime(created_at) }}
					{{ /each }}
		div#chat-input-area.flexitem.chat-input-container
			form(action='/rooms/1/messages' method='POST' on-submit="messageSubmit")
				textarea#message-input.huddle-message-input(autofocus='true', value="{{ messageInput }}", on-keypress="typing" on-keydown-input="set('messageInput', event.node.value)")

	script#new-room-template(type='text/ractive')
		div#new-room-container
			h4 Create a New Room

			form(action="/rooms" method="POST")
				div.form-group
					label(for="name") Name
					input(type="text" placeholder="")
				div.form-group
					label(for="description") Description
					input(type="text")
				button(type="submit") Create Room

	script#private-messages-template(type='text/ractive')
		div#active-private-messages.private-messages-wrapper
			ul#private-messages-container.private-messages-container.sidebar-nav
				li.sidebar-heading
					strong Users
				{{ #each chats }}
				li#users-name.user-name
					a(href="/chat/users/{{ id }}", class="") {{ displayName }}
				{{ /each }}

	script#rooms-template(type='text/ractive')
		div#active-rooms.rooms-wrapper
			ul#rooms-container.rooms-container.sidebar-nav
				li.sidebar-heading 
					strong Rooms
				{{ #each rooms }}
				li#room-name.room-name
					a(href="/rooms/{{ id }}", class="{{ this === activeRoom ? 'active' : '' }}", on-click="loadRoom:{{ . }}") {{ name }}
				{{ /each}}
				li#new-room
					a(href='#' on-click="newRoom") 
						i.fa.fa-plus
						|  New Room